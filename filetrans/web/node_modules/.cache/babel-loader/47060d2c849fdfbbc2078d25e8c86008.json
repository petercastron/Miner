{"remainingRequest":"D:\\fileRun\\node_modules\\thread-loader\\dist\\cjs.js!D:\\fileRun\\node_modules\\babel-loader\\lib\\index.js!D:\\fileRun\\src\\webrtc\\index.js","dependencies":[{"path":"D:\\fileRun\\src\\webrtc\\index.js","mtime":1655349377104},{"path":"D:\\fileRun\\babel.config.js","mtime":1623402045953},{"path":"D:\\fileRun\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1617866813583},{"path":"D:\\fileRun\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1617866813355},{"path":"D:\\fileRun\\node_modules\\babel-loader\\lib\\index.js","mtime":1668408460122}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmV4cG9ydCBkZWZhdWx0IGNsYXNzIFdlYlJUQyB7CiAgY29uc3RydWN0b3IoaWNlU2VydmVycywgc2lnbmFsaW5nVVJMLCByZW1vdGVVVUlELCBvbkNvbm5lY3QsIG9uUHJvZ3Jlc3MsIG9uQ29tcGxldGUpIHsKICAgIGlmICh0eXBlb2YgaWNlU2VydmVycyA9PSAic3RyaW5nIikgewogICAgICBpY2VTZXJ2ZXJzID0gW3sKICAgICAgICB1cmxzOiBpY2VTZXJ2ZXJzCiAgICAgIH1dOwogICAgfQogICAgdGhpcy5fcGMgPSBuZXcgUlRDUGVlckNvbm5lY3Rpb24oewogICAgICBpY2VTZXJ2ZXJzCiAgICB9KTsKICAgIHRoaXMuX3BjLm9uaWNlY2FuZGlkYXRlID0gZSA9PiB7CiAgICAgIGlmIChlLmNhbmRpZGF0ZSkgewogICAgICAgIHRoaXMuc2VuZHRvKHsKICAgICAgICAgIHR5cGU6ICJjYW5kaWRhdGUiLAogICAgICAgICAgY2FuZGlkYXRlOiBlLmNhbmRpZGF0ZS5jYW5kaWRhdGUKICAgICAgICB9KTsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IGRjID0gdGhpcy5fcGMuY3JlYXRlRGF0YUNoYW5uZWwocmVtb3RlVVVJRCk7CiAgICBkYy5vbm9wZW4gPSAoKSA9PiB7CiAgICAgIHRoaXMuX2NoYW5uZWxPcGVuZWQgPSB0cnVlOwogICAgfTsKICAgIHZhciBidWZmZXJzID0gW107CiAgICB2YXIgbG9hZGVkID0gMDsKICAgIGRjLm9ubWVzc2FnZSA9IGUgPT4gewogICAgICBpZiAoZS5kYXRhLmJ5dGVMZW5ndGggPiAwKSB7CiAgICAgICAgYnVmZmVycy5wdXNoKGUuZGF0YSk7CiAgICAgICAgbG9hZGVkICs9IGUuZGF0YS5ieXRlTGVuZ3RoOwogICAgICAgIG9uUHJvZ3Jlc3MobG9hZGVkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBkYy5zZW5kKCJvayIpOwogICAgICAgIG9uQ29tcGxldGUoYnVmZmVycyk7CiAgICAgIH0KICAgIH07CiAgICBjb25zdCBjbGllbnRVVUlEID0gRGF0ZS5ub3coKSArICItIiArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDB4RkZGRkZGRkYpOwogICAgdGhpcy5fd3MgPSBuZXcgV2ViU29ja2V0KHNpZ25hbGluZ1VSTCk7CiAgICB0aGlzLl93cy5vbm9wZW4gPSAoKSA9PiB7CiAgICAgIHRoaXMuc2VuZCgiY29ubmVjdCIsIGNsaWVudFVVSUQpOwogICAgfTsKICAgIHRoaXMuX3dzLm9ubWVzc2FnZSA9IGUgPT4gewogICAgICB2YXIgcmVzdWx0ID0gSlNPTi5wYXJzZShlLmRhdGEpOwogICAgICBzd2l0Y2ggKHJlc3VsdC5fbWV0aG9kKSB7CiAgICAgICAgY2FzZSAiY29ubmVjdCI6CiAgICAgICAgICBjb25zb2xlLmxvZygiY29ubmVjdGVkIik7CiAgICAgICAgICBvbkNvbm5lY3QoY2xpZW50VVVJRCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJzZW5kdG8iOgogICAgICAgICAgc3dpdGNoIChyZXN1bHQuZGF0YS50eXBlKSB7CiAgICAgICAgICAgIGNhc2UgIm9mZmVyIjoKICAgICAgICAgICAgICB0aGlzLl9wYy5zZXRSZW1vdGVEZXNjcmlwdGlvbihyZXN1bHQuZGF0YSk7CiAgICAgICAgICAgICAgdGhpcy5fcGMuY3JlYXRlQW5zd2VyKCkudGhlbihhbnN3ZXIgPT4gewogICAgICAgICAgICAgICAgdGhpcy5fcGMuc2V0TG9jYWxEZXNjcmlwdGlvbihhbnN3ZXIpOwogICAgICAgICAgICAgICAgdGhpcy5zZW5kdG8oYW5zd2VyKTsKICAgICAgICAgICAgICB9KS5jYXRjaChlID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgImNhbmRpZGF0ZSI6CiAgICAgICAgICAgICAgdGhpcy5fcGMuYWRkSWNlQ2FuZGlkYXRlKG5ldyBSVENJY2VDYW5kaWRhdGUocmVzdWx0LmRhdGEuY2FuZGlkYXRlKSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfTsKICAgIHRoaXMuX3JlbW90ZVVVSUQgPSByZW1vdGVVVUlEOwogIH0KICBzZW5kdG8oZGF0YSkgewogICAgdGhpcy5fd3Muc2VuZChKU09OLnN0cmluZ2lmeSh7CiAgICAgIF9tZXRob2Q6ICJzZW5kdG8iLAogICAgICB0bzogdGhpcy5fcmVtb3RlVVVJRCwKICAgICAgZGF0YTogZGF0YQogICAgfSkpOwogIH0KICBzZW5kKG1ldGhvZCwgZGF0YSkgewogICAgdGhpcy5fd3Muc2VuZChKU09OLnN0cmluZ2lmeSh7CiAgICAgIF9tZXRob2Q6IG1ldGhvZCwKICAgICAgZGF0YTogZGF0YQogICAgfSkpOwogIH0KICBpc0NoYW5uZWxPcGVuZWQoKSB7CiAgICByZXR1cm4gdGhpcy5fY2hhbm5lbE9wZW5lZDsKICB9CiAgY2xvc2UoKSB7CiAgICB0aGlzLl9wYy5jbG9zZSgpOwogICAgdGhpcy5fd3MuY2xvc2UoKTsKICB9Cn0="},{"version":3,"names":["WebRTC","constructor","iceServers","signalingURL","remoteUUID","onConnect","onProgress","onComplete","urls","_pc","RTCPeerConnection","onicecandidate","e","candidate","sendto","type","dc","createDataChannel","onopen","_channelOpened","buffers","loaded","onmessage","data","byteLength","push","send","clientUUID","Date","now","Math","floor","random","_ws","WebSocket","result","JSON","parse","_method","console","log","setRemoteDescription","createAnswer","then","answer","setLocalDescription","catch","error","addIceCandidate","RTCIceCandidate","_remoteUUID","stringify","to","method","isChannelOpened","close"],"sources":["D:/fileRun/src/webrtc/index.js"],"sourcesContent":["export default class WebRTC {\r\n\tconstructor(iceServers, signalingURL, remoteUUID, onConnect, onProgress, onComplete) {\r\n\t\tif (typeof(iceServers) == \"string\") {\r\n\t\t\ticeServers = [{\r\n\t\t\t\turls: iceServers\r\n\t\t\t}]\r\n\t\t}\r\n\t\tthis._pc = new RTCPeerConnection({\r\n\t\t\ticeServers\r\n\t\t})\r\n\t\tthis._pc.onicecandidate = e => {\r\n\t\t\tif (e.candidate) {\r\n\t\t\t\tthis.sendto({\r\n\t\t\t\t\ttype: \"candidate\",\r\n\t\t\t\t\tcandidate: e.candidate.candidate\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst dc = this._pc.createDataChannel(remoteUUID)\r\n\t\tdc.onopen = () => {\r\n\t\t\tthis._channelOpened = true\r\n\t\t}\r\n\t\tvar buffers = []\r\n\t\tvar loaded = 0\r\n\t\tdc.onmessage = e => {\r\n\t\t\tif (e.data.byteLength > 0) {\r\n\t\t\t\tbuffers.push(e.data)\r\n\t\t\t\tloaded += e.data.byteLength\r\n\t\t\t\tonProgress(loaded)\r\n\t\t\t} else {\r\n\t\t\t\tdc.send(\"ok\")\r\n\t\t\t\tonComplete(buffers)\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst clientUUID = Date.now() + \"-\" + Math.floor(Math.random() * 0xFFFFFFFF)\r\n\t\tthis._ws = new WebSocket(signalingURL)\r\n\t\tthis._ws.onopen = () => {\r\n\t\t\tthis.send(\"connect\", clientUUID)\r\n\t\t}\r\n\t\tthis._ws.onmessage = e => {\r\n\t\t\tvar result = JSON.parse(e.data)\r\n\t\t\tswitch (result._method) {\r\n\t\t\t\tcase \"connect\":\r\n\t\t\t\t\tconsole.log(\"connected\")\r\n\t\t\t\t\tonConnect(clientUUID)\r\n\t\t\t\t\tbreak\r\n\t\t\t\tcase \"sendto\":\r\n\t\t\t\t\tswitch (result.data.type) {\r\n\t\t\t\t\t\tcase \"offer\":\r\n\t\t\t\t\t\t\tthis._pc.setRemoteDescription(result.data)\r\n\t\t\t\t\t\t\tthis._pc.createAnswer().then(answer => {\r\n\t\t\t\t\t\t\t\tthis._pc.setLocalDescription(answer)\r\n\t\t\t\t\t\t\t\tthis.sendto(answer)\r\n\t\t\t\t\t\t\t}).catch(e => {\r\n\t\t\t\t\t\t\t\tconsole.error(e)\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tbreak\r\n\t\t\t\t\t\tcase \"candidate\":\r\n\t\t\t\t\t\t\tthis._pc.addIceCandidate(new RTCIceCandidate(result.data.candidate))\r\n\t\t\t\t\t\t\tbreak\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._remoteUUID = remoteUUID;\r\n\t}\r\n\r\n\tsendto(data) {\r\n\t\tthis._ws.send(JSON.stringify({\r\n\t\t\t_method: \"sendto\",\r\n\t\t\tto: this._remoteUUID,\r\n\t\t\tdata: data\r\n\t\t}))\r\n\t}\r\n\r\n\tsend(method, data) {\r\n\t\tthis._ws.send(JSON.stringify({\r\n\t\t\t_method: method,\r\n\t\t\tdata: data\r\n\t\t}))\r\n\t}\r\n\r\n\tisChannelOpened() {\r\n\t\treturn this._channelOpened\r\n\t}\r\n\r\n\tclose() {\r\n\t\tthis._pc.close()\r\n\t\tthis._ws.close()\r\n\t}\r\n}\n"],"mappings":"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"}]}